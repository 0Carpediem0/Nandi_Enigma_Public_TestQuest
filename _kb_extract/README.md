# Парсер библиотеки файлов ЭРИС

Парсер сайта [eriskip.com](https://eriskip.com/ru/files-library?category=14) для формирования **базы знаний** из метаданных и **из содержимого PDF-файлов** — для оператора или нейросетевого ассистента.

## Установка

```bash
pip install -r requirements.txt
```

Требуются: `requests`, `beautifulsoup4`, `pymupdf` (для извлечения текста из PDF).

## Запуск

По умолчанию парсер:
1. Собирает со страницы список из ~100 документов (категория 14 — Руководство по эксплуатации).
2. **Скачивает каждый PDF**, извлекает из него текст и сохраняет в папку `база_знаний_тексты/`.
3. Формирует таблицу **`база_знаний_ЭРИС.csv`** с метаданными и ссылками на извлечённые тексты (и превью текста в таблице).

```bash
python parser.py
```

Результат:
- **`база_знаний_ЭРИС.csv`** — таблица базы знаний (разделитель `;`, UTF-8 с BOM для Excel).
- **`база_знаний_тексты/`** — папка с текстовыми файлами `{id}_{название}.txt` (полный текст из каждого PDF).

### Параметры

| Параметр | Описание |
|----------|----------|
| `--category ID` | ID категории (по умолчанию 14) |
| `--max-pages N` | Ограничить число страниц (для теста) |
| `--csv FILE` | Имя выходного CSV |
| `--tsv FILE` | Дополнительно сохранить TSV |
| `--no-content` | Не скачивать PDF и не извлекать текст (только метаданные со страницы) |
| `--content-dir DIR` | Папка для текстов из PDF (по умолчанию `база_знаний_тексты`) |
| `--delay SEC` | Пауза между загрузками PDF в секундах (по умолчанию 1.0) |

Примеры:

```bash
# Полная база знаний: метаданные + тексты из всех 100 PDF (займёт время)
python parser.py

# Только метаданные, без загрузки PDF
python parser.py --no-content

# Тест: 2 страницы и извлечение текста только из этих документов
python parser.py --max-pages 2 --content-dir тест_тексты

# Другая категория
python parser.py --category 20 --csv "руководства_по_монтажу.csv"
```

## Структура таблицы базы знаний

| Колонка | Назначение |
|---------|------------|
| **id** | Внутренний идентификатор файла на сайте |
| **category** | Название категории |
| **title** | Название документа |
| **format**, **size** | Формат и размер файла |
| **description** | Описание (со страницы) |
| **file_url** | Прямая ссылка на скачивание PDF |
| **keywords** | Ключевые слова/модели для поиска (ЭРИС-110, ДГС ЭРИС-210 и т.д.) |
| **answer_template** | Готовый шаблон ответа для оператора/нейросети |
| **page_num** | Номер страницы на сайте |
| **content_file** | Имя файла с извлечённым текстом (в папке `--content-dir`) |
| **content_length** | Длина извлечённого текста (символов) |
| **content_preview** | Превью текста из PDF (первые ~4000 символов) для поиска в таблице |

Колонки **content_file**, **content_preview** и папка с текстами позволяют строить базу знаний **из содержимого** руководств: полнотекстовый поиск, RAG, ответы ассистента по тексту документов.

## Использование базы знаний

- **Оператор**: поиск по названию, ключевым словам или по превью текста в CSV; при необходимости открыть полный текст из `база_знаний_тексты/{content_file}`.
- **Чат-бот / RAG**: индексировать тексты из папки `база_знаний_тексты/` (или колонку `content_preview` + загрузка полного текста по `content_file`) в векторную БД и по запросу возвращать релевантные фрагменты и ссылки на PDF.

## Категории на сайте (ID для `--category`)

На сайте доступны категории, например: 4 — Рекламная продукция, 14 — Руководство по эксплуатации, 20 — Руководство по монтажу, 21 — Руководство по функциональной безопасности и др. Полный список виден в меню на [странице библиотеки](https://eriskip.com/ru/files-library).
